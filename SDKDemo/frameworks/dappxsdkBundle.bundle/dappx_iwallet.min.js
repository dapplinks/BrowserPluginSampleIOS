if(!window.IWalletJS){let t=function(t){t||(t={});let e=window.dappxInfo;return t.appName=e.appName,t.appIcon=e.appIcon,t.appVersion=e.appVersion,t.blockchain=e.blockchain||"IOST",t.walletId=dappxCommon.walletId,t},e={gasPrice:100,gasLimit:1e5,delay:0},a="https://api.iost.io",o="http://13.52.105.102:30001";class n{constructor(){this.map={}}on(t,e){return this.map[t]=e,this}pushMsg(t,e){let a=this.map[t];a&&a(e)}}let l=function(e){let a=e.actions[0],o=this.currentRPC._provider._host.indexOf("//api.iost.io")>-1?"MAINNET":"TESTNET",l=t();l.desc="执行合约",l.payload={tx:e,domain:document.domain,account:this.account._id,network:o,txABI:[a.contract,a.actionName,JSON.parse(a.data)]};let c=new n;return dappxCommon.callFunction("transaction",l,function(t){let e=t.receipt;0==t.code&&e?(c.pushMsg("pending",e.tx_hash),c.pushMsg("success",e)):c.pushMsg("failed",t.message)}),c};window.IWalletJS={newIOST:t=>{IWalletJS.pack=t,IWalletJS.iost=new t.IOST(e);const n=new t.HTTPProvider("MAINNET"==IWalletJS.network?a:o);return IWalletJS.rpc=new t.RPC(n),IWalletJS.iost.signAndSend=l,IWalletJS.iost.setRPC(IWalletJS.rpc),IWalletJS.iost.setAccount(IWalletJS.iost.account),IWalletJS.iost.account=new t.Account(IWalletJS.account),IWalletJS.iost.rpc=IWalletJS.rpc,IWalletJS.iost},enable:()=>new Promise((e,a)=>{if(IWalletJS.iost&&IWalletJS.iost.account)return void e(IWalletJS.iost.account._id);if(IWalletJS.account)return void e(IWalletJS.account);let o=t();o.desc="登录",dappxCommon.callFunction("select",o,function(t){0==t.code?(o.walletId=dappxCommon.walletId=t.wallet,dappxCommon.callFunction("auth",o,function(t){if(0!=t.code)return void a(t.message);let o=t.account;IWalletJS.setAccount({account:o,network:"MAINNET"}),e(o)})):a(t.message)})}),setAccount:({account:t,network:e})=>{IWalletJS.account=t,IWalletJS.network=e}}}