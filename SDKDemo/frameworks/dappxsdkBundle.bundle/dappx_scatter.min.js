if(!window.dappxScatter){let t,n;window.dappxScatter={},"undefined"!=typeof ScatterJS?t=ScatterJS:window.ScatterJS&&(t=window.ScatterJS),n=t?t.scatter:window.scatter?window.scatter:{};let o=function(t){return t<10?String.fromCharCode(48+t):String.fromCharCode(97+t-10)},e=function(t){let n="";for(let e=0;e<t.length;e++){let a=t[e];n+=o(a>>4)+o(15&a)}return n},a=function(t){let n=[];for(let o=0;o<t.length;o++){let e=t.charCodeAt(o);e>=65536&&e<=1114111?(n.push(e>>18&7|240),n.push(e>>12&63|128),n.push(e>>6&63|128),n.push(63&e|128)):e>=2048&&e<=65535?(n.push(e>>12&15|224),n.push(e>>6&63|128),n.push(63&e|128)):e>=128&&e<=2047?(n.push(e>>6&31|192),n.push(63&e|128)):n.push(255&e)}return n},i=function(t){t||(t={});let n=window.dappxInfo;return t.appName=n.appName,t.appIcon=n.appIcon,t.appVersion=n.appVersion,t.blockchain=n.blockchain,t.walletId=dappxCommon.walletId,t},c={id:"Unico",auth:function(t,o,e){let a=t.account,i=t.password;a&&i?dappxCommon.callFunction("requestHttp",{url:"https://unico.eosplay.me/api/user/account/login",data:"mobile="+a+"&password="+i,method:"POST"},function(t){if(200!=t.code)return void e("login failed, server error "+t.code);let c=JSON.parse(t.content);if(0!=c.errno)return void e(c.errmsg);localStorage.unicoAccount=a,localStorage.unicoPassword=i;let r=c.data.user,s=r.name,u={publicKey:r.publicKey,name:s,accounts:[{name:s,authority:r.authority,blockchain:"eos"}]};localStorage.unicoToken=r.token,n.identity=u,o(u)}):e("please login")},sign:function(t,n){dappxCommon.callFunction("requestHttp",{url:"https://unico.eosplay.me/api/game/tools/sign",headers:{"Content-Type":"application/x-www-form-urlencoded",token:localStorage.unicoToken},data:"tx="+t+"&password="+localStorage.unicoPassword,method:"POST"},function(t){if(200!=t.code)return void n(null);let o=JSON.parse(t.content);if(0!=o.errno)return 1028==o.errno?(window.scatter.logout(),void window.scatter.login()):void n(o.errmsg);n(o.data.signature)})},signTransaction:function(t,n,o){let a=i();a.actions=[];let r="";for(let t=0;t<c.data.actions.length;t++){let n=c.data.actions[t];c.data.actions.length>1&&(r+="Action "+(t+1)+":\\n"),r+="account: "+n.account+"\\n",r+="name: "+n.name+"\\n",r+="data: {\\n";for(let t in n.data){r+="  "+t+": "+n.data[t]+"\\n"}r+="}\\n\\n"}a.attach=JSON.stringify({title:"请求执行合约",desc:r}),dappxCommon.callFunction("transaction",a,function(a){0==a.code&&1==a.confirm?c.sign(e(t),function(t){t?n([t]):o(!1)}):o("cancel")})},signMessage:function(t,n,o){let r=i();r.message="",r.attach=JSON.stringify({title:"请求签名",desc:t}),dappxCommon.callFunction("sign",r,function(i){if(0!=i.code||1!=i.confirm)return void o("cancel");let r=e(a(t));c.sign(r,function(t){t?n(t):o(!1)})})}},r=function(t,n,o={}){let e={httpEndpoint:t.protocol+"://"+t.host+(t.port?":"+t.port:""),chainId:t.chainId,signProvider:function(t){return new Promise(function(n,o){c.signTransaction(t.buf,n,o)})}};return n.call(n,e)||n},s={connect:function(){return new Promise(function(t,n){t(!0)})},isConnected:function(){return!0},suggestNetwork:function(){return new Promise(function(t,n){t(!0)})},getIdentity:function(){return dappxCommon.dumpArgs("getIdentity"),new Promise(function(t,o){if(n.identity)return void t(n.identity);let e=i();e.desc="登录";let a=window.dappxInfo;e.enabledWallets=a.enabledWallets,dappxCommon.callFunction("select",e,function(a){0==a.code?(e.walletId=dappxCommon.walletId=a.wallet,dappxCommon.walletId==c.id&&(e.attach=JSON.stringify({account:localStorage.unicoAccount||"",password:localStorage.unicoPassword||""})),dappxCommon.callFunction("auth",e,function(e){if(0!=e.code)return void o(e.message);if(dappxCommon.walletId==c.id)return void c.auth(e,t,o);let a=e.account,i={publicKey:e.public_key,name:a,accounts:[{name:a,authority:"active",blockchain:"eos"}]};n.identity=i,t(i)})):o(a.message)})})},login:function(){return s.getIdentity.apply(this,arguments)},useIdentity:function(){},forgetIdentity:function(){return n.identity&&(n.identity=void 0),localStorage.unicoAccount=null,localStorage.unicoPassword=null,localStorage.unicoToken=null,new Promise(function(t,n){t(!0)})},logout:function(){return s.forgetIdentity.apply(this,arguments)},requireVersion:function(){return"1.0"},authenticate:function(t,n,o){let e=location.host;return"www."==e.substring(0,4)&&(e=e.substring(4)),s.getArbitrarySignature(o,e)},getArbitrarySignature:function(t,n){return new Promise(function(t,o){if(dappxCommon.walletId==c.id)return void c.signMessage(n,t,o);let e=i();e.desc="签名",e.message=n,dappxCommon.callFunction("sign",e,function(n){0==n.code?t(n.sign):o(n.message)})})},eos:function(){let t,o={transfer:function(){let n;return n="string"==typeof arguments[0]?{from:arguments[0],to:arguments[1],quantity:arguments[2],memo:arguments[3]}:arguments[0],dappxCommon.walletId==c.id?(c.data={actions:[{account:"eosio.token",name:"transfer",data:n}]},t.transfer.apply(this,arguments)):new Promise(function(t,o){let e=n.quantity.split(" "),a=i();a.desc="转账",a.from=n.from,a.to=n.to,a.amount=e[0],a.precision=4,a.symbol=e[1],a.contract="eosio.token",a.memo=n.memo,dappxCommon.callFunction("transfer",a,function(n){0==n.code?t({transaction_id:n.transaction_id}):o(n.message)})})},transaction:function(n){return dappxCommon.walletId==c.id?(c.data=n,t.transaction.apply(this,arguments)):new Promise(function(o,e){let a=i(n);a.desc="执行合约",dappxCommon.callFunction("transaction",a,function(n){0==n.code?function(n){let o=n.transaction_id;return new Promise(function(e,a){if(n.transaction_data)return n.transaction_data.transaction_id=o,void e(n.transaction_data);t.getTransaction({id:o}).then(function(t){let n=t.trx.trx,o=n.actions;for(let t=0;t<o.length;t++){let n=o[t];n.hex_data&&(n.data=n.hex_data)}let a={transaction_id:t.id,transaction:{transaction:n,signatures:n.signatures}};Object.assign(t,a),e(t)}).catch(function(t){e({transaction_id:o})})})}(n).then(function(t){o(t)}):e(n.message)})})},transact:function(){return o.transaction.apply(this,arguments)},contract:function(e){return new Promise(function(a,i){t.contract(e).then(function(t){let i=new Proxy({},{get:function(a,i){return"then"==i?a[i]:function(){let a,c,r;try{if("object"==typeof arguments[0])throw"arguments exception";let n,o=t.fc.abi.structs;for(let t=0;t<o.length;t++){let e=o[t];if(e.name==i){n=e;break}}a={};for(let t=0;t<n.fields.length;t++){let o=n.fields[t].name,e=arguments[t];a[o]=e}c=arguments[arguments.length-1]}catch(t){a=arguments[0],c=arguments[1]}try{let t=function(t){let n=t.split("@");return{actor:n[0],permission:n[1]}};if("string"==typeof(r=c.authorization))r=[t(r)];else for(let n=0;n<r.length;n++){let o=r[n];"string"==typeof o&&(r[n]=t(o))}}catch(t){r=[{actor:n.identity.accounts[0].name,permission:"active"}]}return new Promise(function(t,n){let c={account:e,name:i,authorization:r,data:a};o.transaction({actions:[c]}).then(function(n){t(n)}).catch(function(t){n(t)})})}}});a(i)}).catch(function(t){i(t)})})}};return t=r.apply(this,arguments),dappxCommon.proxy(t,o)}};window.scatter=dappxCommon.proxy(n,s),document.dispatchEvent(new CustomEvent("scatterLoaded"))}